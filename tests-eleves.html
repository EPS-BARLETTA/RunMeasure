<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChronoVitesse ‚Äî Tests √âl√®ve</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>üß¨ Tests VMA ‚Äî √âl√®ve</h1>
      <div class="actions">
        <a class="btn" href="index.html">üè† Accueil</a>
        <button class="btn ghost" id="help">‚ùì Explications</button>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="content">
          <h2>1) Identit√©</h2>
          <div class="grid-2">
            <div><label>Nom</label><input class="input" id="nom" placeholder="Martin"></div>
            <div><label>Pr√©nom</label><input class="input" id="prenom" placeholder="Julie"></div>
            <div><label>Classe</label><input class="input" id="classe" placeholder="4C"></div>
            <div><label>Sexe</label>
              <select class="input" id="sexe">
                <option value="M">Gar√ßon (M)</option>
                <option value="F">Fille (F)</option>
              </select>
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="content">
          <h2>2) Choix du test</h2>
          <div class="grid-2">
            <div>
              <label>Test</label>
              <select class="input" id="test">
                <option value="cooper">Cooper (12 min)</option>
                <option value="demi">Demi‚ÄëCooper (6 min)</option>
                <option value="vameval">VAMEVAL (palier)</option>
              </select>
            </div>
            <div id="cooperBox">
              <label>Distance (m)</label>
              <input class="input" id="distance" type="number" min="0" step="1" placeholder="ex. 2100">
            </div>
            <div id="vamevalBox" style="display:none">
              <label>Palier / Vitesse (km/h)</label>
              <div class="actions">
                <button class="btn" id="minusPalier">‚àí</button>
                <span class="badge" id="palierVal">8.0</span>
                <button class="btn" id="plusPalier">+</button>
              </div>
              <div class="help">Utilise les gros boutons pour fixer le <strong>dernier palier tenu</strong>. La VMA = vitesse du palier atteint.</div>
            </div>
          </div>
          <div class="grid-3" style="margin-top:10px">
            <div class="kpi"><div class="big" id="k-temps">‚Äî</div><div class="label">Temps</div></div>
            <div class="kpi"><div class="big" id="k-vit">‚Äî</div><div class="label">Vitesse (km/h)</div></div>
            <div class="kpi"><div class="big" id="k-vma">‚Äî</div><div class="label">VMA (km/h)</div></div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="content">
          <h2>3) QR Code ScanProf</h2>
          <div class="actions">
            <button class="btn ok" id="makeQr">üßæ G√©n√©rer</button>
            <button class="btn" id="showJson">üëÄ Voir JSON</button>
            <button class="btn primary" id="savePng">‚¨áÔ∏è QR (PNG)</button>
          </div>
          <div class="kpi" style="margin-top:8px"><div id="qrcode">QR ici‚Ä¶</div></div>
          <div class="help">Format: tableau d'objets {nom, prenom, classe, sexe, distance, vitesse, vma}</div>
        </div>
      </section>
    </div>

    <footer>ChronoVitesse ‚Äî √âquipe EPS Lyc√©e Vauban ‚Äî Luxembourg ‚Äî JB</footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    const $ = (id)=>document.getElementById(id);

    const testEl = $('test'); const distEl = $('distance');
    const palierVal = $('palierVal');
    let palier = 8.0;

    function updateUI(){
      const t = testEl.value;
      const kTemps = $('k-temps'); const kVit = $('k-vit'); const kVma = $('k-vma');
      if(t==='cooper' || t==='demi'){
        $('cooperBox').style.display='block'; $('vamevalBox').style.display='none';
        const tempsMin = t==='cooper'?12:6; kTemps.textContent = tempsMin+' min';
        const d = Number(distEl.value||0);
        const vit = d/1000 / (tempsMin/60);
        kVit.textContent = isFinite(vit)&&vit>0? vit.toFixed(2) : '‚Äî';
        kVma.textContent = kVit.textContent;
      } else {
        $('cooperBox').style.display='none'; $('vamevalBox').style.display='block';
        kTemps.textContent = '‚Äî';
        kVit.textContent = palier.toFixed(1);
        kVma.textContent = palier.toFixed(1);
      }
    }

    testEl.onchange=updateUI;
    distEl.oninput=updateUI;
    $('minusPalier').onclick=()=>{ palier = Math.max(6, palier-0.5); palierVal.textContent=palier.toFixed(1); updateUI(); };
    $('plusPalier').onclick=()=>{ palier = Math.min(24, palier+0.5); palierVal.textContent=palier.toFixed(1); updateUI(); };

    // QR
    const qr = new QRCode('qrcode', {text:'',width:220,height:220});
    function payload(){
      const t = testEl.value;
      let distance=0,vitesse=0,vma=0;
      if(t==='cooper' || t==='demi'){
        const d = Number(distEl.value||0);
        const tempsMin = t==='cooper'?12:6;
        distance = Math.round(d);
        vitesse = distance/1000 / (tempsMin/60);
        vma = vitesse;
      } else {
        distance = 0;
        vitesse = palier;
        vma = palier;
      }
      return JSON.stringify([{
        nom:$('nom').value.trim(), prenom:$('prenom').value.trim(),
        classe:$('classe').value.trim(), sexe:$('sexe').value,
        distance:Number(distance||0), vitesse:Number(vitesse.toFixed(2)||0), vma:Number(vma.toFixed(2)||0)
      }]);
    }
    $('makeQr').onclick=()=>{ const req=['nom','prenom','classe']; for(const id of req){ if(!$(id).value.trim()){ alert('Nom, Pr√©nom, Classe requis.'); return; } } qr.makeCode(payload()); };
    $('showJson').onclick=()=>{ const j = payload(); navigator.clipboard?.writeText(j); alert(j); };
    $('savePng').onclick=()=>{ const el=document.querySelector('#qrcode canvas,#qrcode img'); if(!el){ alert('G√©n√©rer d\'abord'); return; } let url; if(el.tagName.toLowerCase()==='canvas'){ url=el.toDataURL('image/png'); } else { const c=document.createElement('canvas'); c.width=el.naturalWidth; c.height=el.naturalHeight; c.getContext('2d').drawImage(el,0,0); url=c.toDataURL('image/png'); } const a=document.createElement('a'); a.href=url; a.download='qr-scanprof.png'; document.body.appendChild(a); a.click(); a.remove(); };

    updateUI();
  </script>
</body>
</html>
