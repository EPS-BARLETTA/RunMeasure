<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Chrono & Intervalles</title><link rel="stylesheet" href="styles.css"></head>
<body><div class="container">
<header><h1>üéØ Chrono & Intervalles</h1><div class="actions"><a class="btn" href="eleve.html">‚¨ÖÔ∏è Retour</a></div></header>
<div class="card"><div class="content center" style="gap:18px;flex-direction:column">
  <div class="grid-3" style="width:100%">
    <div><label>Distance cible (m)</label><input class="input" id="target" type="number" value="800"></div>
    <div><label>Pas (m)</label><input class="input" id="step" type="number" value="200"></div>
    <div><label>Piste (m)</label><input class="input" id="lapm" type="number" value="200"></div>
  </div>
  <div class="timer" id="circle"><div class="center"><div class="time" id="time">00:00.000</div><div class="hint" id="idInfo"></div></div><div class="hand" id="hand"></div></div>
  <div class="actions"><button class="btn ok big" id="start">‚ñ∂Ô∏è Start</button><button class="btn warn big" id="pause">‚è∏ Pause</button><button class="btn danger big" id="reset">‚ü≤ Reset</button></div>
  <div class="actions"><button class="btn" id="passStep">Passage +pas</button><button class="btn" id="passLap">Passage +tour</button></div>
  <div class="grid" style="width:100%">
    <div class="card"><div class="content"><h2>Interm√©diaires</h2><div class="help" id="logStep">‚Äî</div></div></div>
    <div class="card"><div class="content"><h2>Passages tours</h2><div class="help" id="logLap">‚Äî</div></div></div>
  </div>
  <div class="kpi"><div class="big" id="done">0 / 800 m</div><div class="label">Progression</div></div>
  <div class="qrbox"><div id="qr"></div><div class="actions"><button class="btn ok" id="makeQR">üßæ QR</button><button class="btn primary" id="saveQR">‚¨áÔ∏è PNG</button></div></div>
</div></div><div class="footer">ChronoVitesse - Equipe EPS Lyc√©e Vauban - LUXEMBOURG - JB</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const $ = (id)=>document.getElementById(id);
function qs(key){ return new URLSearchParams(location.search).get(key)||''; }
function identity(){ return { nom:qs('nom'), prenom:qs('prenom'), classe:qs('classe'), sexe:qs('sexe')||'M' }; }
function payloadDistance({distance=0, tempsMs=0, vma=0}){
  const hours = tempsMs>0 ? (tempsMs/3600000) : 0;
  const vitesse = hours>0 ? (distance/1000)/hours : 0;
  const id = identity();
  return [{
    nom:id.nom, prenom:id.prenom, classe:id.classe, sexe:id.sexe,
    distance: Math.round(distance),
    vitesse: Number(vitesse.toFixed(2)),
    vma: Number((vma||0).toFixed(2))
  }];
}
function showQR(boxId, dataArray){
  const txt = JSON.stringify(dataArray);
  const box = $(boxId); box.innerHTML='';
  new QRCode(box, {text:txt, width:220, height:220}); return txt;
}
function downloadQR(boxId, name='qr-scanprof.png'){
  const el=document.querySelector('#'+boxId+' canvas, #'+boxId+' img'); if(!el){ alert('G√©n√©rer le QR d\'abord.'); return; }
  let url; if(el.tagName.toLowerCase()==='canvas'){ url=el.toDataURL('image/png'); } else { const c=document.createElement('canvas'); c.width=el.naturalWidth; c.height=el.naturalHeight; c.getContext('2d').drawImage(el,0,0); url=c.toDataURL('image/png'); }
  const a=document.createElement('a'); a.href=url; a.download=name; document.body.appendChild(a); a.click(); a.remove();
}
function setTimerCircle(elemId, pct){
  const deg=Math.max(0,Math.min(100,pct))*3.6; const el=$(elemId); el.style.background=`conic-gradient(var(--accent) ${deg}deg, #e5e7eb ${deg}deg)`;
}
function formatMS(ms){ const m=Math.floor(ms/60000), s=Math.floor((ms%60000)/1000), z=Math.floor(ms%1000); return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0')+'.'+String(z).padStart(3,'0'); }
</script>

<script>
const id = identity(); document.getElementById('idInfo').textContent=id.nom+' '+id.prenom+' ‚Äî '+id.classe;
let running=false,start=0,elapsed=0,dist=0,stepDist=0,lapDist=0, steps=[], laps=[];
function loop(){ if(!running) return; const t=performance.now()-start+elapsed; document.getElementById('time').textContent=formatMS(t); const sec=(t/1000)%60; document.getElementById('hand').style.transform=`translate(-50%,-100%) rotate(${sec/60*360}deg)`; requestAnimationFrame(loop); }
function updateDone(){ const target=Number(document.getElementById('target').value||0); document.getElementById('done').textContent=dist+' / '+target+' m'; setTimerCircle('circle', (dist/target)*100); if(dist>=target && running){ running=false; } }
document.getElementById('start').onclick=()=>{ if(!running){ running=true; start=performance.now(); loop(); steps=[]; laps=[]; dist=0; stepDist=0; lapDist=0; updateDone(); document.getElementById('logStep').textContent='‚Äî'; document.getElementById('logLap').textContent='‚Äî'; } };
document.getElementById('pause').onclick=()=>{ if(running){ elapsed+=performance.now()-start; running=false; } };
document.getElementById('reset').onclick=()=>{ running=false; start=0; elapsed=0; dist=0; stepDist=0; lapDist=0; steps=[]; laps=[]; document.getElementById('time').textContent='00:00.000'; updateDone(); document.getElementById('logStep').textContent='‚Äî'; document.getElementById('logLap').textContent='‚Äî'; setTimerCircle('circle',0); };
document.getElementById('passStep').onclick=()=>{ if(!running) return; const t=performance.now()-start+elapsed; stepDist+=Number(document.getElementById('step').value||0); dist=Math.min(Number(document.getElementById('target').value||0), dist+Number(document.getElementById('step').value||0)); steps.push({d:stepDist,t}); document.getElementById('logStep').textContent = steps.map(x=>x.d+'m : '+formatMS(x.t)).join(' | '); updateDone(); };
document.getElementById('passLap').onclick=()=>{ if(!running) return; const t=performance.now()-start+elapsed; lapDist+=Number(document.getElementById('lapm').value||0); dist=Math.min(Number(document.getElementById('target').value||0), dist+Number(document.getElementById('lapm').value||0)); laps.push({d:lapDist,t}); document.getElementById('logLap').textContent = laps.map(x=>x.d+'m : '+formatMS(x.t)).join(' | '); updateDone(); };
document.getElementById('makeQR').onclick=()=>{ const t=(running?performance.now()-start:0)+elapsed; const data=payloadDistance({distance:dist, tempsMs:t}); const txt=showQR('qr', data); navigator.clipboard?.writeText(txt); };
document.getElementById('saveQR').onclick=()=>downloadQR('qr');
updateDone();
</script></body></html>
