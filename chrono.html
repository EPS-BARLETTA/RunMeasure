
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chrono simple</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
</head>
<body>
<header>
  <h1>⏱️ Chrono simple</h1>
  <div class="header-right"><a class="btn" href="menu.html">Modes</a><a class="btn" href="aide.html">Aide</a></div>
</header>
<main class="container">
  <section class="panel center"><div id="timer" class="timer">00:00.0</div></section>
  <section class="panel center">
    <div class="action-bar">
      <button id="start" class="btn btn-start btn-lg">Démarrer</button>
      <button id="stop" class="btn btn-stop btn-lg" disabled>Stop</button>
      <button id="reset" class="btn btn-reset" disabled>Réinitialiser</button>
      <button id="openSettings" class="btn">⚙️</button>
    </div>
    <div class="kpi" style="margin-top:8px">
      <span class="tag">Distance: <strong id="dist">0</strong> m</span>
      <span class="tag">Tours: <strong id="laps">0</strong></span>
    </div>
  </section>
  <section id="qr" class="panel qr hidden"><h2>QR compatible ScanProf</h2><div id="qrBox" class="qr-box"></div></section>
</main>
<div class="footer">ChronoVitesse — Équipe EPS Lycée Vauban — LUXEMBOURG — JB</div>

<div id="modal" class="modal">
  <div class="card">
    <h2>Paramètres chrono</h2>
    <label>Longueur d’un tour (m) <input id="tourLen" type="number" min="0" step="1" placeholder="ex: 200"></label>
    <div class="row" style="justify-content:space-between;margin-top:10px">
      <div class="row">
        <button id="lapBtn" class="btn">+1 tour</button>
        <button id="halfBtn" class="btn">+½</button>
      </div>
      <div class="row">
        <button class="btn cancel">Annuler</button>
        <button class="btn btn-primary save">Enregistrer</button>
      </div>
    </div>
  </div>
</div>

<script src="common.js"></script>
<script>
const p=requireParams();
let t0=null,tick=null,totalDist=0,tour=0,laps=0;
const timer=document.getElementById('timer'); const distEl=document.getElementById('dist'); const lapsEl=document.getElementById('laps');
function applyDistance(v){ totalDist=Math.max(0, Math.round(totalDist+v)); distEl.textContent=totalDist; }
bindModal('modal','openSettings',()=>{ tour=Number(document.getElementById('tourLen').value||0); });
document.getElementById('lapBtn').addEventListener('click',()=>{ if(!tour){alert('Indique d’abord la longueur d’un tour.');return;} laps++; lapsEl.textContent=laps; applyDistance(tour); });
document.getElementById('halfBtn').addEventListener('click',()=>{ if(!tour){alert('Indique d’abord la longueur d’un tour.');return;} applyDistance(tour*0.5); });
start.onclick=()=>{ t0=Date.now(); tick=setInterval(()=> timer.textContent=formatMs(Date.now()-t0),100); start.disabled=true; stop.disabled=false; reset.disabled=true; };
stop.onclick=()=>{ clearInterval(tick); stop.disabled=true; reset.disabled=false;
  const duree_s=Math.round((Date.now()-t0)/1000);
  const item=buildScanProfItem({ nom:p.nom, prenom:p.prenom, classe:p.classe, sexe:p.sexe, distance_m:totalDist, duree_s, vma_kmh:null });
  showQR([item]);
};
reset.onclick=()=>{ clearInterval(tick); timer.textContent='00:00.0'; start.disabled=false; stop.disabled=true; reset.disabled=true; totalDist=0;laps=0;distEl.textContent=0;lapsEl.textContent=0; document.getElementById('qr').classList.add('hidden'); };
</script>
</body>
</html>
