
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VMA</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
</head>
<body>
<header>
  <h1>ðŸ§ª VMA</h1>
  <div class="header-right"><a class="btn" href="menu.html">Modes</a><a class="btn" href="aide.html">Aide</a></div>
</header>
<main class="container">
  <section class="panel">
    <h2>Test</h2>
    <div class="grid two">
      <label>Type de test
        <select id="type">
          <option value="cooper">Cooper (12 min)</option>
          <option value="six">Demi-Cooper / Astrand (6 min)</option>
          <option value="leger">LÃ©ger-Boucher (palier)</option>
          <option value="vameval">VAMEVAL (palier)</option>
          <option value="libre">Libre (distance & durÃ©e)</option>
        </select>
      </label>
      <label id="distField">Distance (m) <input id="distance" type="number" min="0"></label>
      <label id="durField">DurÃ©e (s) <input id="duree" type="number" min="0"></label>
    </div>
    <div class="grid two hidden" id="palierFields">
      <label>Palier <input id="palier" type="number" min="1"></label>
      <label>Navettes (option) <input id="navettes" type="number" min="0"></label>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="calc" class="btn btn-primary">Calculer</button>
      <div class="kpi"><span class="tag">VMA: <strong id="vOut">â€”</strong> km/h</span></div>
      <button id="genQR" class="btn">ðŸ“± GÃ©nÃ©rer QR</button>
    </div>
    <p class="small">Remplis les champs puis <strong>Calculer</strong>. Pour Cooper et 6â€², entre la distance parcourue. Pour Libre, saisie distance & durÃ©e.</p>
  </section>
  <section id="qr" class="panel qr hidden"><h2>QR compatible ScanProf</h2><div id="qrBox" class="qr-box"></div></section>
</main>
<div class="footer">ChronoVitesse â€” Ã‰quipe EPS LycÃ©e Vauban â€” LUXEMBOURG â€” JB</div>

<script src="common.js"></script>
<script>
const p=requireParams();
const typeSel=type, distI=distance, durI=duree, palF=document.getElementById('palierFields'), distF=document.getElementById('distField'), durF=document.getElementById('durField');
function sync(){
  const t=typeSel.value;
  const isPal = (t==='leger'||t==='vameval');
  palF.classList.toggle('hidden', !isPal);
  distF.classList.toggle('hidden', isPal?true:false);
  durF.classList.toggle('hidden', !(t==='libre'));
  if(t==='cooper'){ durI.value=720; durF.classList.add('hidden'); distF.classList.remove('hidden'); }
  if(t==='six'){ durI.value=360; durF.classList.add('hidden'); distF.classList.remove('hidden'); }
}
sync(); typeSel.addEventListener('change', sync);

function compute(){
  const t=typeSel.value;
  let vma=0, dist=0, duree_s=0;
  if(t==='cooper'){ dist=Number(distI.value||0); duree_s=720; vma=+(dist*0.005).toFixed(2); }
  else if(t==='six'){ dist=Number(distI.value||0); duree_s=360; vma=+(dist*0.01).toFixed(2); }
  else if(t==='leger'){ const pal=Number(document.getElementById('palier').value||0); vma=+(8.5+0.5*(Math.max(1,pal)-1)).toFixed(2); dist=0; duree_s=0; }
  else if(t==='vameval'){ const pal=Number(document.getElementById('palier').value||0); vma=+(8.0+0.5*(Math.max(1,pal)-1)).toFixed(2); dist=0; duree_s=0; }
  else { dist=Number(distI.value||0); duree_s=Number(durI.value||0); vma=+((dist>0&&duree_s>0 ? dist/duree_s*3.6 : 0)).toFixed(2); }
  vOut.textContent=vma.toFixed(2);
  return {vma, dist, duree_s};
}
document.getElementById('calc').onclick=compute;
document.getElementById('genQR').onclick=()=>{
  const r=compute();
  const item=buildScanProfItem({ nom:p.nom, prenom:p.prenom, classe:p.classe, sexe:p.sexe, distance_m:r.dist, duree_s:r.duree_s, vma_kmh:r.vma });
  showQR([item]);
};
</script>
</body>
</html>
