<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VMA Prof ‚Äî VAMEVAL Audio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1020;--card:#121933;--muted:#9fb3ff;--text:#e8edff;--accent:#4f7cff;--ok:#22c55e;--warn:#ffb020;--danger:#ef4444}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:900px;margin:0 auto;padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{margin:0;font-size:28px;font-weight:800}
    .card{background:var(--card);border:1px solid #1b2751;border-radius:16px;padding:16px;margin-top:12px}
    label{font-size:14px;color:var(--muted);font-weight:600}
    input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #26336e;background:#0d1430;color:var(--text)}
    .row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .btn{appearance:none;border:0;background:#1a2452;color:#fff;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--accent)} .btn.ok{background:var(--ok);color:#08241a} .btn.warn{background:var(--warn);color:#191200} .btn.danger{background:var(--danger)}
    .screen{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px}
    .tile{background:#0d1430;border:1px dashed #2a3870;border-radius:14px;padding:18px;text-align:center}
    .big{font-size:56px;font-weight:800}
    .mid{font-size:20px;color:#c9d4ff}
    footer{text-align:center;margin-top:18px;color:#9fb3ff80;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap" id="root">
    <header>
      <h1>VMA Prof ‚Äî VAMEVAL Audio</h1>
      <div class="controls">
        <a class="btn" href="index.html">üè† Accueil</a>
        <button class="btn" id="fullscreenBtn">‚õ∂ Plein √©cran</button>
      </div>
    </header>

    <div class="card">
      <div class="row">
        <div>
          <label>Vitesse d√©part (km/h)</label>
          <input id="startSpeed" type="number" value="8" min="6" max="16" step="0.5">
        </div>
        <div>
          <label>Incr√©ment (+km/h / min)</label>
          <input id="inc" type="number" value="0.5" step="0.1" min="0.1" max="1">
        </div>
        <div>
          <label>Longueur balise (m)</label>
          <input id="lap" type="number" value="20" min="10" step="1">
        </div>
        <div>
          <label>Volume (0‚Äì1)</label>
          <input id="volume" type="number" value="0.6" min="0" max="1" step="0.05">
        </div>
      </div>
      <div class="controls">
        <button class="btn ok" id="startBtn">‚ñ∂Ô∏è Start</button>
        <button class="btn warn" id="pauseBtn">‚è∏ Pause</button>
        <button class="btn danger" id="resetBtn">‚ü≤ Reset</button>
      </div>
    </div>

    <div class="screen">
      <div class="tile">
        <div class="mid">Palier / Vitesse</div>
        <div class="big" id="speedLabel">8.0</div>
        <div class="mid">km/h</div>
      </div>
      <div class="tile">
        <div class="mid">Temps palier</div>
        <div class="big" id="timeLabel">00:00</div>
        <div class="mid" id="statusLabel">Pr√™t</div>
      </div>
    </div>

    <div class="card">
      <div class="mid">Bip balise toutes les <span id="cadenceLabel">9.00</span> s (20 m)</div>
    </div>

    <footer>Chrono/Vitesse EPS ‚Äî √âquipe EPS Lyc√©e Vauban ‚Äî Luxembourg ‚Äî JB</footer>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    let ctx, osc, gain;
    let running = false, paused = false;
    let startTs = 0, elapsed = 0, minuteTimer = null, lapTimer = null;
    let currentSpeed = 8.0, palier = 0;

    function ms(){ return performance.now(); }
    function fmt(t){ const s = Math.floor(t/1000); const m = Math.floor(s/60); const r = s%60; return String(m).padStart(2,'0')+':'+String(r).padStart(2,'0'); }
    function kph_to_mps(v){ return v*1000/3600; }
    function lap_interval_seconds(speed_kph, lap_m){ const v = kph_to_mps(speed_kph); return lap_m / v; } // seconds

    function updateScreen(){
      $('speedLabel').textContent = currentSpeed.toFixed(1);
      $('timeLabel').textContent = fmt(elapsed);
      const lapS = lap_interval_seconds(currentSpeed, Number($('lap').value||20));
      $('cadenceLabel').textContent = lapS.toFixed(2);
    }

    function beep(tone=880, duration=0.08){
      if(!ctx){ ctx = new (window.AudioContext||window.webkitAudioContext)(); }
      gain = ctx.createGain(); gain.gain.value = Number($('volume').value||0.5);
      osc = ctx.createOscillator(); osc.type='sine'; osc.frequency.value=tone;
      osc.connect(gain).connect(ctx.destination);
      osc.start();
      setTimeout(()=>{ osc.stop(); }, duration*1000);
    }

    function scheduleTimers(){
      // minute timer for palier increase
      minuteTimer = setInterval(()=>{
        palier += 1;
        currentSpeed = Number(currentSpeed) + Number($('inc').value||0.5);
        beep(1200, 0.12); // palier beep
      }, 60*1000);

      // lap timer based on current speed; reschedule each minute when speed changes
      function setLapTimer(){
        const lap_m = Number($('lap').value||20);
        const iv = lap_interval_seconds(currentSpeed, lap_m)*1000;
        lapTimer = setInterval(()=>{ beep(800,0.06); }, iv);
      }
      setLapTimer();

      // reschedule lap timer every minute to follow speed increase
      const rescheduler = setInterval(()=>{
        if(!running){ clearInterval(rescheduler); return; }
        if(lapTimer) clearInterval(lapTimer);
        setLapTimer();
      }, 60*1000);
    }

    function start(){
      if(running && paused){ paused=false; startTs = ms()-elapsed; $('statusLabel').textContent='Reprise'; return; }
      if(running) return;
      running = true; paused = false;
      currentSpeed = Number($('startSpeed').value||8);
      palier = 0; elapsed = 0; startTs = ms();
      $('statusLabel').textContent='En cours';
      updateScreen();
      scheduleTimers();
      tick();
    }

    function pause(){
      if(!running || paused) return;
      paused = true;
      elapsed = ms()-startTs;
      $('statusLabel').textContent='En pause';
      if(minuteTimer) clearInterval(minuteTimer);
      if(lapTimer) clearInterval(lapTimer);
    }

    function reset(){
      running=false; paused=false;
      if(minuteTimer) clearInterval(minuteTimer);
      if(lapTimer) clearInterval(lapTimer);
      elapsed=0; currentSpeed = Number($('startSpeed').value||8);
      $('statusLabel').textContent='Pr√™t';
      updateScreen();
    }

    function tick(){
      if(!running) return;
      if(!paused){
        elapsed = ms()-startTs;
        updateScreen();
      }
      requestAnimationFrame(tick);
    }

    $('startBtn').addEventListener('click', start);
    $('pauseBtn').addEventListener('click', pause);
    $('resetBtn').addEventListener('click', reset);

    $('fullscreenBtn').addEventListener('click', async()=>{
      const el = document.getElementById('root');
      if(document.fullscreenElement){ await document.exitFullscreen(); }
      else { await el.requestFullscreen().catch(()=>{}); }
    });

    ['startSpeed','inc','lap','volume'].forEach(id=>$(id).addEventListener('input', updateScreen));
    updateScreen();
  </script>
</body>
</html>
